
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Readium Mobile is a toolkit for ebooks, audiobooks and comics written in Swift & Kotlin.">
      
      
        <meta name="author" content="Readium Foundation">
      
      
        <link rel="canonical" href="https://github.com/readium/kotlin-toolkit/2.3.0/guides/tts/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.2.11">
    
    
      
        <title>Text-to-speech - Readium Kotlin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../readium_colors.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#text-to-speech" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Readium Kotlin" class="md-header__button md-logo" aria-label="Readium Kotlin" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Readium Kotlin
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Text-to-speech
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/readium/kotlin-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kotlin-toolkit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Readium Kotlin" class="md-nav__button md-logo" aria-label="Readium Kotlin" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Readium Kotlin
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/readium/kotlin-toolkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kotlin-toolkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../migration-guide/" class="md-nav__link">
        Migration Guide
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          User Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../navigator-preferences/" class="md-nav__link">
        Navigator preferences
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../epub-fonts/" class="md-nav__link">
        EPUB font families
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pdf/" class="md-nav__link">
        PDF support
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Text-to-speech
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Text-to-speech
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    Glossary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-a-publication-aloud" class="md-nav__link">
    Reading a publication aloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observing-the-playback-state" class="md-nav__link">
    Observing the playback state
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-tts" class="md-nav__link">
    Configuring the TTS
  </a>
  
    <nav class="md-nav" aria-label="Configuring the TTS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-language" class="md-nav__link">
    Default language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#speech-rate" class="md-nav__link">
    Speech rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voice" class="md-nav__link">
    Voice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-missing-voice-data" class="md-nav__link">
    Installing missing voice data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronizing-the-tts-with-a-navigator" class="md-nav__link">
    Synchronizing the TTS with a Navigator
  </a>
  
    <nav class="md-nav" aria-label="Synchronizing the TTS with a Navigator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-the-tts-from-the-visible-page" class="md-nav__link">
    Starting the TTS from the visible page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highlighting-the-currently-spoken-utterance" class="md-nav__link">
    Highlighting the currently spoken utterance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turning-pages-automatically" class="md-nav__link">
    Turning pages automatically
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-utterance-tokenizer" class="md-nav__link">
    Using a custom utterance tokenizer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-tts-engine" class="md-nav__link">
    Using a custom TTS engine
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../content/" class="md-nav__link">
        Extracting the content of a publication
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/shared/index.md" class="md-nav__link">
        Shared
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/streamer/index.md" class="md-nav__link">
        Streamer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/navigator/index.md" class="md-nav__link">
        Navigator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/opds/index.md" class="md-nav__link">
        OPDS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/lcp/index.md" class="md-nav__link">
        LCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_6">
          Adapters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Adapters" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Adapters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/navigator-media2/index.md" class="md-nav__link">
        Navigator media2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/adapters/pdfium/pdfium-document/index.md" class="md-nav__link">
        PDFium Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/adapters/pdfium/pdfium-navigator/index.md" class="md-nav__link">
        PDFium Navigator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/adapters/pspdfkit/pspdfkit-document/index.md" class="md-nav__link">
        PSPDFKit Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../readium/adapters/pspdfkit/pspdfkit-navigator/index.md" class="md-nav__link">
        PSPDFKit Navigator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    Glossary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-a-publication-aloud" class="md-nav__link">
    Reading a publication aloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observing-the-playback-state" class="md-nav__link">
    Observing the playback state
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-tts" class="md-nav__link">
    Configuring the TTS
  </a>
  
    <nav class="md-nav" aria-label="Configuring the TTS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-language" class="md-nav__link">
    Default language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#speech-rate" class="md-nav__link">
    Speech rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voice" class="md-nav__link">
    Voice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-missing-voice-data" class="md-nav__link">
    Installing missing voice data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronizing-the-tts-with-a-navigator" class="md-nav__link">
    Synchronizing the TTS with a Navigator
  </a>
  
    <nav class="md-nav" aria-label="Synchronizing the TTS with a Navigator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-the-tts-from-the-visible-page" class="md-nav__link">
    Starting the TTS from the visible page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highlighting-the-currently-spoken-utterance" class="md-nav__link">
    Highlighting the currently spoken utterance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turning-pages-automatically" class="md-nav__link">
    Turning pages automatically
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-utterance-tokenizer" class="md-nav__link">
    Using a custom utterance tokenizer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-custom-tts-engine" class="md-nav__link">
    Using a custom TTS engine
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/readium/kotlin-toolkit/edit/master/docs/guides/tts.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="text-to-speech">Text-to-speech<a class="headerlink" href="#text-to-speech" title="Permanent link">&para;</a></h1>
<p>:warning: The API described in this guide will be changed in the next version of the Kotlin toolkit to support background TTS playback and media notifications. It is recommended that you wait before integrating it in your app.</p>
<p>Text-to-speech can be used to read aloud a publication using a synthetic voice. The Readium toolkit ships with a TTS implementation based on the native <a href="https://developer.android.com/reference/android/speech/tts/TextToSpeech">Android TTS engine</a>, but it is opened for extension if you want to use a different TTS engine.</p>
<h2 id="glossary">Glossary<a class="headerlink" href="#glossary" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>engine</strong> – a TTS engine takes an utterance and transforms it into audio using a synthetic voice</li>
<li><strong>rate</strong> - speech speed of a synthetic voice</li>
<li><strong>tokenizer</strong> - algorithm splitting the publication text content into individual utterances, usually by sentences</li>
<li><strong>utterance</strong> - a single piece of text played by a TTS engine, such as a sentence</li>
<li><strong>voice</strong> – a synthetic voice is used by a TTS engine to speak a text using rules pertaining to the voice's language and region</li>
</ul>
<h2 id="reading-a-publication-aloud">Reading a publication aloud<a class="headerlink" href="#reading-a-publication-aloud" title="Permanent link">&para;</a></h2>
<p>To read a publication, you need to create an instance of <code>PublicationSpeechSynthesizer</code>. It orchestrates the rendition of a publication by iterating through its content, splitting it into individual utterances using a <code>ContentTokenizer</code>, then using a <code>TtsEngine</code> to read them aloud. Not all publications can be read using TTS, therefore the constructor returns a nullable object. You can also check whether a publication can be played beforehand using <code>PublicationSpeechSynthesizer.canSpeak(publication)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">synthesizer</span> <span class="o">=</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">(</span>
    <span class="n">publication</span> <span class="o">=</span> <span class="n">publication</span><span class="p">,</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Configuration</span><span class="p">(</span>
        <span class="n">rateMultiplier</span> <span class="o">=</span> <span class="m">1.25</span>
    <span class="p">),</span>
    <span class="n">listener</span> <span class="o">=</span> <span class="k">object</span> <span class="p">:</span> <span class="nc">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Listener</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>Then, begin the playback from a given starting <code>Locator</code>. When missing, the playback will start from the beginning of the publication.</p>
<div class="highlight"><pre><span></span><code><span class="n">synthesizer</span><span class="p">.</span><span class="na">start</span><span class="p">()</span>
</code></pre></div>
<p>You should now hear the TTS engine speak the utterances from the beginning. <code>PublicationSpeechSynthesizer</code> provides the APIs necessary to control the playback from the app:</p>
<ul>
<li><code>stop()</code> - stops the playback ; requires start to be called again</li>
<li><code>pause()</code> - interrupts the playback temporarily</li>
<li><code>resume()</code> - resumes the playback where it was paused</li>
<li><code>pauseOrResume()</code> - toggles the pause</li>
<li><code>previous()</code> - skips to the previous utterance</li>
<li><code>next()</code> - skips to the next utterance</li>
</ul>
<p>Look at <code>TtsControls</code> in the Test App for an example of a view calling these APIs.</p>
<p>:warning: Once you are done with the synthesizer, you should call <code>close()</code> to release held resources.</p>
<h2 id="observing-the-playback-state">Observing the playback state<a class="headerlink" href="#observing-the-playback-state" title="Permanent link">&para;</a></h2>
<p>The <code>PublicationSpeechSynthesizer</code> should be the single source of truth to represent the playback state in your user interface. You can observe the <code>synthesizer.state</code> property to keep your user interface synchronized with the playback. The possible states are:</p>
<ul>
<li><code>Stopped</code> when idle and waiting for a call to <code>start()</code>.</li>
<li><code>Paused(utterance: Utterance)</code> when interrupted while playing <code>utterance</code>.</li>
<li><code>Playing(utterance: Utterance, range: Locator?)</code> when speaking <code>utterance</code>. This state is updated repeatedly while the utterance is spoken, updating the <code>range</code> property with the portion of utterance being played (usually the current word).</li>
</ul>
<p>When pairing the <code>PublicationSpeechSynthesizer</code> with a <code>Navigator</code>, you can use the <code>utterance.locator</code> and <code>range</code> properties to highlight spoken utterances and turn pages automatically.</p>
<h2 id="configuring-the-tts">Configuring the TTS<a class="headerlink" href="#configuring-the-tts" title="Permanent link">&para;</a></h2>
<p>The <code>PublicationSpeechSynthesizer</code> offers some options to configure the TTS engine. Note that the support of each configuration option depends on the TTS engine used.</p>
<p>Update the configuration by setting it directly. The configuration is not applied right away but for the next utterance.</p>
<div class="highlight"><pre><span></span><code><span class="n">synthesizer</span><span class="p">.</span><span class="na">setConfig</span><span class="p">(</span><span class="n">synthesizer</span><span class="p">.</span><span class="na">config</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
    <span class="n">defaultLanguage</span> <span class="o">=</span> <span class="n">Language</span><span class="p">(</span><span class="n">Locale</span><span class="p">.</span><span class="na">FRENCH</span><span class="p">)</span>
<span class="p">))</span>
</code></pre></div>
<p>To keep your settings user interface up to date when the configuration changes, observe the <code>PublicationSpeechSynthesizer.config</code> property. Look at <code>TtsControls</code> in the Test App for an example of a TTS settings screen.</p>
<h3 id="default-language">Default language<a class="headerlink" href="#default-language" title="Permanent link">&para;</a></h3>
<p>The language used by the synthesizer is important, as it determines which TTS voices are used and the rules to tokenize the publication text content.</p>
<p>By default, <code>PublicationSpeechSynthesizer</code> will use any language explicitly set on a text element (e.g. with <code>lang="fr"</code> in HTML) and fall back on the global language declared in the publication manifest. You can override the fallback language with <code>Configuration.defaultLanguage</code> which is useful when the publication language is incorrect or missing.</p>
<h3 id="speech-rate">Speech rate<a class="headerlink" href="#speech-rate" title="Permanent link">&para;</a></h3>
<p>The <code>rateMultiplier</code> configuration sets the speech speed as a multiplier, 1.0 being the normal speed. The available range depends on the TTS engine and can be queried with <code>synthesizer.rateMultiplierRange</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Configuration</span><span class="p">(</span>
    <span class="n">rateMultiplier</span> <span class="o">=</span> <span class="n">multiplier</span><span class="p">.</span><span class="na">coerceIn</span><span class="p">(</span><span class="n">synthesizer</span><span class="p">.</span><span class="na">rateMultiplierRange</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="voice">Voice<a class="headerlink" href="#voice" title="Permanent link">&para;</a></h3>
<p>The <code>voice</code> setting can be used to change the synthetic voice used by the engine. To get the available list, use <code>synthesizer.availableVoices</code>. Note that the available voices can change during runtime, observe <code>availableVoices</code> to keep your interface up to date.</p>
<p>To restore a user-selected voice, persist the unique voice identifier returned by <code>voice.id</code>.</p>
<p>Users do not expect to see all available voices at all time, as they depend on the selected language. You can group the voices by their language and filter them by the selected language using the following snippet.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Supported voices grouped by their language.</span>
<span class="kd">val</span> <span class="nv">voicesByLanguage</span><span class="p">:</span> <span class="n">Flow</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Language</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Voice</span><span class="o">&gt;&gt;&gt;</span> <span class="o">=</span>
    <span class="n">synthesizer</span><span class="p">.</span><span class="na">availableVoices</span>
        <span class="p">.</span><span class="na">map</span> <span class="p">{</span> <span class="n">voices</span> <span class="o">-&gt;</span> <span class="n">voices</span><span class="p">.</span><span class="na">groupBy</span> <span class="p">{</span> <span class="nb">it</span><span class="p">.</span><span class="na">language</span> <span class="p">}</span> <span class="p">}</span>

<span class="c1">// Supported voices for the language selected in the configuration.</span>
<span class="kd">val</span> <span class="nv">voicesForSelectedLanguage</span><span class="p">:</span> <span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Voice</span><span class="o">&gt;&gt;</span> <span class="o">=</span>
    <span class="n">combine</span><span class="p">(</span>
        <span class="n">synthesizer</span><span class="p">.</span><span class="na">config</span><span class="p">.</span><span class="na">map</span> <span class="p">{</span> <span class="nb">it</span><span class="p">.</span><span class="na">defaultLanguage</span> <span class="p">},</span>
        <span class="n">voicesByLanguage</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span> <span class="n">language</span><span class="p">,</span> <span class="n">voices</span> <span class="o">-&gt;</span>
        <span class="n">language</span>
            <span class="o">?.</span><span class="na">let</span> <span class="p">{</span> <span class="n">voices</span><span class="o">[</span><span class="nb">it</span><span class="o">]</span> <span class="p">}</span>
            <span class="o">?.</span><span class="na">sortedBy</span> <span class="p">{</span> <span class="nb">it</span><span class="p">.</span><span class="na">name</span> <span class="o">?:</span> <span class="nb">it</span><span class="p">.</span><span class="na">id</span> <span class="p">}</span>
            <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div>
<h2 id="installing-missing-voice-data">Installing missing voice data<a class="headerlink" href="#installing-missing-voice-data" title="Permanent link">&para;</a></h2>
<p>:point_up: This only applies if you use the default <code>AndroidTtsEngine</code>.</p>
<p>Sometimes the device does not have access to all the data required by a selected voice, in which case the user needs to download it manually. You can catch the <code>TtsEngine.Exception.LanguageSupportIncomplete</code> error and call <code>synthesizer.engine.requestInstallMissingVoice()</code> to start the system voice download activity.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">synthesizer</span> <span class="o">=</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">publication</span><span class="p">)</span>

<span class="n">synthesizer</span><span class="p">.</span><span class="na">listener</span> <span class="o">=</span> <span class="k">object</span> <span class="p">:</span> <span class="nc">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Listener</span> <span class="p">{</span>
    <span class="kd">override</span> <span class="kd">fun</span> <span class="nf">onUtteranceError</span><span class="p">(</span> <span class="n">utterance</span><span class="p">:</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Utterance</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">handle</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">override</span> <span class="kd">fun</span> <span class="nf">onError</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">handle</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">fun</span> <span class="nf">handle</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">.</span><span class="na">Exception</span><span class="p">.</span><span class="na">Engine</span> <span class="o">-&gt;</span>
                <span class="k">when</span> <span class="p">(</span><span class="kd">val</span> <span class="nv">err</span> <span class="o">=</span> <span class="n">error</span><span class="p">.</span><span class="na">error</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">is</span> <span class="n">TtsEngine</span><span class="p">.</span><span class="na">Exception</span><span class="p">.</span><span class="na">LanguageSupportIncomplete</span> <span class="o">-&gt;</span> <span class="p">{</span>
                        <span class="n">synthesizer</span><span class="p">.</span><span class="na">engine</span><span class="p">.</span><span class="na">requestInstallMissingVoice</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                    <span class="p">}</span>

                    <span class="k">else</span> <span class="o">-&gt;</span> <span class="p">{</span>
                        <span class="p">...</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<h2 id="synchronizing-the-tts-with-a-navigator">Synchronizing the TTS with a Navigator<a class="headerlink" href="#synchronizing-the-tts-with-a-navigator" title="Permanent link">&para;</a></h2>
<p>While <code>PublicationSpeechSynthesizer</code> is completely independent from <code>Navigator</code> and can be used to play a publication in the background, most apps prefer to render the publication while it is being read aloud. The <code>Locator</code> core model is used as a means to synchronize the synthesizer with the navigator.</p>
<h3 id="starting-the-tts-from-the-visible-page">Starting the TTS from the visible page<a class="headerlink" href="#starting-the-tts-from-the-visible-page" title="Permanent link">&para;</a></h3>
<p><code>PublicationSpeechSynthesizer.start()</code> takes a starting <code>Locator</code> for parameter. You can use it to begin the playback from the currently visible page in a <code>VisualNavigator</code> using <code>firstVisibleElementLocator()</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">navigator</span> <span class="k">as?</span> <span class="n">VisualNavigator</span><span class="p">)</span><span class="o">?.</span><span class="na">firstVisibleElementLocator</span><span class="p">()</span>
<span class="n">synthesizer</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">fromLocator</span> <span class="o">=</span> <span class="n">start</span><span class="p">)</span>
</code></pre></div>
<h3 id="highlighting-the-currently-spoken-utterance">Highlighting the currently spoken utterance<a class="headerlink" href="#highlighting-the-currently-spoken-utterance" title="Permanent link">&para;</a></h3>
<p>If you want to highlight or underline the current utterance on the page, you can apply a <code>Decoration</code> on the utterance locator with a <code>DecorableNavigator</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">navigator</span><span class="p">:</span> <span class="n">DecorableNavigator</span>

<span class="n">synthesizer</span><span class="p">.</span><span class="na">state</span>
    <span class="p">.</span><span class="na">map</span> <span class="p">{</span> <span class="p">(</span><span class="nb">it</span> <span class="k">as?</span> <span class="n">State</span><span class="p">.</span><span class="na">Playing</span><span class="p">)</span><span class="o">?.</span><span class="na">utterance</span> <span class="p">}</span>
    <span class="p">.</span><span class="na">distinctUntilChanged</span><span class="p">()</span>
    <span class="p">.</span><span class="na">onEach</span> <span class="p">{</span> <span class="n">utterance</span> <span class="o">-&gt;</span>
        <span class="n">navigator</span><span class="p">.</span><span class="na">applyDecorations</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span>
            <span class="n">Decoration</span><span class="p">(</span>
                <span class="n">id</span> <span class="o">=</span> <span class="s">&quot;tts-utterance&quot;</span><span class="p">,</span>
                <span class="n">locator</span> <span class="o">=</span> <span class="n">utterance</span><span class="p">.</span><span class="na">locator</span><span class="p">,</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">Decoration</span><span class="p">.</span><span class="na">Style</span><span class="p">.</span><span class="na">Highlight</span><span class="p">(</span><span class="n">tint</span> <span class="o">=</span> <span class="n">Color</span><span class="p">.</span><span class="na">RED</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">),</span> <span class="n">group</span> <span class="o">=</span> <span class="s">&quot;tts&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="na">launchIn</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
</code></pre></div>
<h3 id="turning-pages-automatically">Turning pages automatically<a class="headerlink" href="#turning-pages-automatically" title="Permanent link">&para;</a></h3>
<p>You can use the same technique as described above to automatically synchronize the <code>Navigator</code> with the played utterance, using <code>navigator.go(utterance.locator)</code>.</p>
<p>However, this will not turn pages mid-utterance, which can be annoying when speaking a long sentence spanning two pages. To address this, you can go to the <code>State.Playing.range</code> locator instead, which is updated regularly while speaking each word of an utterance. Note that jumping to the <code>range</code> locator for every word can severely impact performances. To alleviate this, you can throttle the flow using <a href="https://github.com/Kotlin/kotlinx.coroutines/issues/1107#issuecomment-1083076517"><code>throttleLatest</code></a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">synthesizer</span><span class="p">.</span><span class="na">state</span>
    <span class="p">.</span><span class="na">filterIsInstance</span><span class="o">&lt;</span><span class="n">State</span><span class="p">.</span><span class="na">Playing</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="p">.</span><span class="na">map</span> <span class="p">{</span> <span class="nb">it</span><span class="p">.</span><span class="na">range</span> <span class="o">?:</span> <span class="nb">it</span><span class="p">.</span><span class="na">utterance</span><span class="p">.</span><span class="na">locator</span> <span class="p">}</span>
    <span class="p">.</span><span class="na">throttleLatest</span><span class="p">(</span><span class="m">1.</span><span class="n">seconds</span><span class="p">)</span>
    <span class="p">.</span><span class="na">onEach</span> <span class="p">{</span> <span class="n">locator</span> <span class="o">-&gt;</span>
        <span class="n">navigator</span><span class="p">.</span><span class="na">go</span><span class="p">(</span><span class="n">locator</span><span class="p">,</span> <span class="n">animated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="na">launchIn</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
</code></pre></div>
<h2 id="using-a-custom-utterance-tokenizer">Using a custom utterance tokenizer<a class="headerlink" href="#using-a-custom-utterance-tokenizer" title="Permanent link">&para;</a></h2>
<p>By default, the <code>PublicationSpeechSynthesizer</code> will split the publication text into sentences to create the utterances. You can customize this for finer or coarser utterances using a different tokenizer.</p>
<p>For example, this will speak the content word-by-word:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">synthesizer</span> <span class="o">=</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">publication</span><span class="p">,</span>
    <span class="n">tokenizerFactory</span> <span class="o">=</span> <span class="p">{</span> <span class="n">language</span> <span class="o">-&gt;</span>
        <span class="n">TextContentTokenizer</span><span class="p">(</span>
            <span class="n">defaultLanguage</span> <span class="o">=</span> <span class="n">language</span><span class="p">,</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">TextUnit</span><span class="p">.</span><span class="na">Word</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>For completely custom tokenizing or to improve the existing tokenizers, you can implement your own <code>ContentTokenizer</code>.</p>
<h2 id="using-a-custom-tts-engine">Using a custom TTS engine<a class="headerlink" href="#using-a-custom-tts-engine" title="Permanent link">&para;</a></h2>
<p><code>PublicationSpeechSynthesizer</code> can be used with any TTS engine, provided they implement the <code>TtsEngine</code> interface. Take a look at <code>AndroidTtsEngine</code> for an example implementation.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span> <span class="nv">synthesizer</span> <span class="o">=</span> <span class="n">PublicationSpeechSynthesizer</span><span class="p">(</span><span class="n">publication</span><span class="p">,</span>
    <span class="n">engineFactory</span> <span class="o">=</span> <span class="p">{</span> <span class="n">listener</span> <span class="o">-&gt;</span> <span class="n">MyCustomEngine</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../pdf/" class="md-footer__link md-footer__link--prev" aria-label="Previous: PDF support" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              PDF support
            </div>
          </div>
        </a>
      
      
        
        <a href="../content/" class="md-footer__link md-footer__link--next" aria-label="Next: Extracting the content of a publication" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Extracting the content of a publication
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Readium Foundation
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.748e2769.min.js"></script>
      
    
  </body>
</html>